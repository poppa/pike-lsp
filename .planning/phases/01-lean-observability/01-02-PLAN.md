---
phase: 01-lean-observability
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/pike-lsp-server/src/core/logging.ts
  - packages/pike-lsp-server/src/core/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Logger class exists with component-based namespacing"
    - "Log levels OFF, ERROR, WARN, INFO, DEBUG, TRACE are defined"
    - "Logger.setLevel() controls global log filtering"
    - "Log output includes timestamp, level, component, message"
    - "Optional context is serialized as JSON"
    - "Logger is exported from core/index.ts"
  artifacts:
    - path: "packages/pike-lsp-server/src/core/logging.ts"
      provides: "Logger class, LogLevel enum"
      min_lines: 70
    - path: "packages/pike-lsp-server/src/core/index.ts"
      provides: "Barrel export including Logger"
      contains: "export.*Logger"
  key_links:
    - from: "packages/pike-lsp-server/src/core/logging.ts"
      to: "console.error"
      via: "Direct output for structured logs"
      pattern: "console.error"
---

<objective>
Create a simple but effective Logger class with component-based namespacing and log levels.

Purpose: Replace ad-hoc console.log/connection.console.log with structured logging. Enable filtering logs by level globally (production = WARN, development = DEBUG).

Output: Logger class with OFF, ERROR, WARN, INFO, DEBUG, TRACE levels and component filtering
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-lean-observability/01-CONTEXT.md
@.planning/phases/01-lean-observability/01-RESEARCH.md

# Existing patterns
@packages/pike-lsp-server/src/server.ts
</context>

<tasks>

<task type="auto">
  <name>Create LogLevel enum and Logger class</name>
  <files>packages/pike-lsp-server/src/core/logging.ts</files>
  <action>
Create packages/pike-lsp-server/src/core/logging.ts with:

1. LogLevel enum (numeric for comparison):
   - OFF = 0
   - ERROR = 1
   - WARN = 2
   - INFO = 3
   - DEBUG = 4
   - TRACE = 5

2. Logger class:
   - Static property: globalLevel (default LogLevel.WARN)
   - Static method: setLevel(level: LogLevel) sets globalLevel
   - Constructor: (component: string) stores component name
   - Private log method: (level, levelName, message, context?) checks level <= globalLevel
   - Public methods: error, warn, info, debug, trace - each takes (msg: string, ctx?: object)
   - Output format: `[timestamp][LEVEL][component] message` + optional JSON context

IMPORTANT: Use console.error (not console.log) for all log levels. This ensures logs go to stderr where LSP servers typically emit diagnostic output.

DO NOT: Add transports, formatters, log rotation, or file output. Keep it minimal.
  </action>
  <verify>
  - Compile with `cd packages/pike-lsp-server && pnpm build`
  - Test: Logger.setLevel(LogLevel.OFF) silences all output
  - Test: Logger.setLevel(LogLevel.TRACE) shows all output
  - Test: new Logger('Test').debug('hello', { foo: 'bar' }) outputs formatted message
  </verify>
  <done>
Logger class compiles, respects global level filtering, formats output correctly
  </done>
</task>

<task type="auto">
  <name>Export Logger from core module</name>
  <files>packages/pike-lsp-server/src/core/index.ts</files>
  <action>
Update packages/pike-lsp-server/src/core/index.ts to also export Logger:
```typescript
export { LSPError, BridgeError, PikeError } from './errors.js';
export { Logger, LogLevel } from './logging.js';
```

Note: This file will be created by 01-01-PLAN.md, so read it first and append the Logger export.
  </action>
  <verify>
  - Compile with `cd packages/pike-lsp-server && pnpm build`
  - Check dist/core/index.js contains both error and logging exports
  </verify>
  <done>
Core module barrel exports all utilities (errors and logging)
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `cd packages/pike-lsp-server && pnpm build`
2. Logger class is properly exported
3. LogLevel enum values are numeric and correctly ordered
4. setLevel() controls global filtering (OFF silences, TRACE shows all)
5. Log output format includes timestamp, level, component, message
</verification>

<success_criteria>
- Logger and LogLevel are exported from @pike-lsp/pike-lsp-server/core
- Logger.setLevel(LogLevel.DEBUG) enables debug output
- Logger.setLevel(LogLevel.ERROR) silences warn/info/debug/trace
- Log format: [2025-01-20T10:30:00.000Z][DEBUG][PikeBridge] message {"ctx":"value"}
</success_criteria>

<output>
After completion, create `.planning/phases/01-lean-observability/01-02-SUMMARY.md`
</output>
