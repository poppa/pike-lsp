---
phase: 03-intelligence-module
plan: 03
type: execute
wave: 3
depends_on: [03-01, 03-02]
files_modified:
  - pike-scripts/LSP.pmod/Intelligence.pike
autonomous: true

must_haves:
  truths:
    - "handle_get_inherited resolves class name using master()->resolv()"
    - "handle_get_inherited retrieves inheritance list via Program.inherit_list()"
    - "Each parent program is introspected for inherited members"
    - "Inherited members from all parents are aggregated into result"
    - "Result includes found flag, members array, inherit_count"
    - "Handle both object and program resolutions"
    - "Errors in class resolution return empty result (not crash)"
  artifacts:
    - path: "pike-scripts/LSP.pmod/Intelligence.pike"
      provides: "Inheritance traversal handler"
      contains: "handle_get_inherited"
  key_links:
    - from: "pike-scripts/LSP.pmod/Intelligence.pike"
      to: "Pike builtins"
      via: "master()->resolv(class_name)"
      pattern: "master\\(\\)->resolv"
    - from: "pike-scripts/LSP.pmod/Intelligence.pike"
      to: "Pike builtins"
      via: "Program.inherit_list(prog)"
      pattern: "Program\\.inherit_list"
    - from: "pike-scripts/LSP.pmod/Intelligence.pike"
      to: "introspect_program helper"
      via: "introspect_program(parent_prog)"
      pattern: "introspect_program"
---

<objective>
Add handle_get_inherited for inheritance hierarchy traversal.

Purpose: Extract handler that retrieves inherited members from parent classes using Program.inherit_list().
Output: Intelligence.pike with inheritance traversal capabilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-intelligence-module**---extract-introspection-and-resolution-handlers/03-CONTEXT.md
@.planning/phases/03-intelligence-module**---extract-introspection-and-resolution-handlers/03-RESEARCH.md
@.planning/phases/03-intelligence-module**---extract-introspection-and-resolution-handlers/03-01-SUMMARY.md
@.planning/phases/03-intelligence-module**---extract-introspection-and-resolution-handlers/03-02-SUMMARY.md
@pike-scripts/analyzer.pike
</context>

<tasks>

<task type="auto">
  <name>Add handle_get_inherited method</name>
  <files>pike-scripts/LSP.pmod/Intelligence.pike</files>
  <action>
Add handle_get_inherited(mapping params) method to Intelligence.pike:

1. Copy implementation from analyzer.pike lines 1497-1536

2. Implementation details:
   - Extract class_name from params->class
   - Resolve class using master()->resolv(class_name) in catch block
   - Handle both object and program:
     - If objectp: use object_program(resolved)
     - If programp: use resolved directly
     - Otherwise return not found result
   - Get inheritance list: Program.inherit_list(prog)
   - Introspect each parent using introspect_program(parent_prog)
   - Aggregate all symbols into all_members array
   - Return result with found, members, inherit_count

3. Error handling:
   - Wrap core logic in catch returning LSP.LSPError on unexpected errors
   - If class resolution fails, return empty result (not error) per CONTEXT.md resolution failure handling

4. Note: This is basic inheritance traversal (no cycle detection yet)
   - Cycle detection can be added in future enhancement
   - Current implementation handles typical shallow inheritance chains

No caching needed for this handler (inheritance data is derived, not stored).
  </action>
  <verify>
grep -E "handle_get_inherited|Program\.inherit_list" pike-scripts/LSP.pmod/Intelligence.pike
  </verify>
  <done>
handle_get_inherited method exists, uses Program.inherit_list(), calls introspect_program on parents
  </done>
</task>

<task type="auto">
  <name>Verify all four handlers are present and consistent</name>
  <files>pike-scripts/LSP.pmod/Intelligence.pike</files>
  <action>
Perform verification and cleanup:

1. Verify all four handlers exist:
   - handle_introspect
   - handle_resolve
   - handle_resolve_stdlib
   - handle_get_inherited

2. Verify all handlers follow same pattern:
   - Each wrapped in catch with LSP.LSPError response
   - Each returns mapping with "result" key on success
   - Each has proper error handling

3. Verify all shared helpers are protected:
   - introspect_program
   - get_module_path
   - parse_stdlib_documentation
   - merge_documentation
   - extract_symbol_name
   - parse_autodoc
   - process_inline_markup
   - save_text_buffer
   - replace_markup
   - format_group_as_text
   - extract_autodoc_comments (if added)

4. Check String.trim_whites() replacement:
   - No remaining String.trim_whites() calls
   - All uses LSP.Compat.trim_whites()

5. Verify module documentation is complete
   - File header describes purpose
   - Each handler has //! comment

6. Run Pike syntax check:
   pike -e "mixed err = catch { master()->resolv('LSP.Intelligence'); }; write(err ? 'Error: %s\\n' : 'OK\\n', describe_error(err));"
  </action>
  <verify>
pike -e "object I = (program)master()->resolv('LSP.Intelligence')->Intelligence(); write('Methods: %O\\n', indices(I));"
  </verify>
  <done>
All four handlers present, consistent error handling, no String.trim_whites() remaining, module loads successfully
  </done>
</task>

</tasks>

<verification>
1. All four handlers exist: `grep -E "handle_(introspect|resolve|resolve_stdlib|get_inherited)" pike-scripts/LSP.pmod/Intelligence.pike | wc -l` equals 4
2. Uses Program.inherit_list: `grep "Program.inherit_list" pike-scripts/LSP.pmod/Intelligence.pike`
3. No String.trim_whites: `! grep -v "LSP.Compat.trim_whites" pike-scripts/LSP.pmod/Intelligence.pike | grep "String.trim_whites"` should be empty
4. Module loads: `pike -e "write('%d\\n', programp(master()->resolv('LSP.Intelligence')->Intelligence));"` returns 1
</verification>

<success_criteria>
1. handle_get_inherited retrieves inherited members from parent classes
2. All four handlers (introspect, resolve, resolve_stdlib, get_inherited) present
3. Handler error handling consistent across all methods
4. No legacy String.trim_whites() calls remaining
5. Intelligence.pike loads successfully in Pike interpreter
</success_criteria>

<output>
After completion, create `.planning/phases/03-intelligence-module**---extract-introspection-and-resolution-handlers/03-03-SUMMARY.md`
</output>
