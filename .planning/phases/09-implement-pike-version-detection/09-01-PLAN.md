---
phase: 09-implement-pike-version-detection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [pike-scripts/analyzer.pike]
autonomous: true

must_haves:
  truths:
    - "analyzer.pike responds to 'get_version' method"
    - "Returns structured version data including major, minor, and build"
  artifacts:
    - path: "pike-scripts/analyzer.pike"
      provides: "get_version RPC handler"
  key_links:
    - from: "analyzer.pike HANDLERS"
      to: "master()->resolv(\"LSP.Compat\")->pike_version()"
      via: "method dispatch"
---

<objective>
Add a get_version RPC method to the Pike analyzer script to allow the bridge to query version information from the running interpreter instance.

Purpose: Avoids spawning extra processes and ensures the reported version matches the one running the LSP.
Output: Updated analyzer.pike with get_version handler.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@pike-scripts/analyzer.pike
@pike-scripts/LSP.pmod/Compat.pmod
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add get_version to analyzer.pike dispatch table</name>
  <files>pike-scripts/analyzer.pike</files>
  <action>
    Add a new "get_version" entry to the HANDLERS mapping in analyzer.pike.
    The handler should use master()->resolv("LSP.Compat")->pike_version() to get the version components.
    Return a mapping containing:
    - version: string (e.g., "8.0.1116")
    - major: int
    - minor: int
    - build: int
    - display: string (from version() function)
  </action>
  <verify>
    echo '{"jsonrpc":"2.0","id":1,"method":"get_version","params":{}}' | pike pike-scripts/analyzer.pike
  </verify>
  <done>
    Analyzer returns valid JSON-RPC response with version details.
  </done>
</task>

</tasks>

<verification>
Verify that the analyzer compiles and responds correctly to the new method.
```bash
pike -e 'compile_file("pike-scripts/analyzer.pike");'
echo '{"jsonrpc":"2.0","id":1,"method":"get_version","params":{}}' | pike pike-scripts/analyzer.pike
```
</verification>

<success_criteria>
analyzer.pike implements get_version and returns structured version data.
</success_criteria>

<output>
After completion, create `.planning/phases/09-implement-pike-version-detection/09-01-SUMMARY.md`
</output>
