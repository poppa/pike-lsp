---
phase: 16-stdlib-performance
plan: 02
type: execute
wave: 2
depends_on: [16-01]
files_modified:
  - packages/pike-lsp-server/src/stdlib-index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "StdlibIndexManager allows loading bootstrap modules (Stdio, String, Array, Mapping)"
    - "Hover on common stdlib types shows documentation"
    - "No hardcoded blacklist preventing stdlib introspection"
  artifacts:
    - path: "packages/pike-lsp-server/src/stdlib-index.ts"
      provides: "StdlibIndexManager without bootstrap module blacklist"
      contains: "BOOTSTRAP_MODULES"
  key_links:
    - from: "StdlibIndexManager"
      to: "PikeBridge.resolveStdlib"
      via: "loadModule() method"
      pattern: "await this\\.bridge\\.resolveStdlib"
    - from: "negativeCache"
      to: "bootstrap modules"
      via: "pre-population in constructor"
      pattern: "this\\.negativeCache\\.add"
---

<objective>
Remove the bootstrap module blacklist from StdlibIndexManager so stdlib modules can be loaded and cached.

Purpose: TypeScript-side StdlibIndexManager has a hardcoded blacklist (BOOTSTRAP_MODULES Set) that prevents loading Stdio, String, Array, Mapping. Now that Pike-side introspection works (16-01), we must remove this block so users can hover on these types and get documentation.

Output: StdlibIndexManager allows all stdlib modules to be loaded on-demand.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/16-stdlib-performance/16-RESEARCH.md
@.planning/phases/16-stdlib-performance/16-01-PLAN.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/pike-lsp-server/src/stdlib-index.ts
</context>

<tasks>

<task type="auto">
  <name>Remove bootstrap module blacklist from StdlibIndexManager</name>
  <files>packages/pike-lsp-server/src/stdlib-index.ts</files>
  <action>
    Remove the BOOTSTRAP_MODULES Set and its usage from StdlibIndexManager.

    Changes needed:
    1. Delete the BOOTSTRAP_MODULES readonly Set (lines 86-91)
    2. Remove the pre-population loop in constructor (lines 98-101)
    3. Keep the negativeCache functionality for modules that genuinely don't exist

    Do NOT remove:
    - The negativeCache itself (needed for actual missing modules)
    - The getModule() negative cache check (line 109)

    After removal, there should be no reference to BOOTSTRAP_MODULES in the file.
  </action>
  <verify>! grep -q "BOOTSTRAP_MODULES" packages/pike-lsp-server/src/stdlib-index.ts</verify>
  <done>BOOTSTRAP_MODULES Set and pre-population removed, negativeCache remains for actual missing modules</done>
</task>

<task type="auto">
  <name>Verify stdlib modules load via bridge</name>
  <files>packages/pike-lsp-server/src/stdlib-index.ts</files>
  <action>
    Test that stdlib modules now load through the StdlibIndexManager.

    Create test:
    ```bash
    cd packages/pike-lsp-server && cat > /tmp/test-stdlib-index.mjs << 'EOF'
    import { StdlibIndexManager } from './dist/src/stdlib-index.js';
    import { PikeBridge } from '@pike-lsp/pike-bridge';

    const bridge = new PikeBridge();
    await bridge.start();

    const manager = new StdlibIndexManager(bridge);

    const testModules = ['Stdio', 'String', 'Array', 'Mapping'];
    for (const mod of testModules) {
      const info = await manager.getModule(mod);
      console.log(`${mod}: ${info ? `loaded (${info.symbols?.size || 0} symbols)` : 'FAILED'}`);
    }

    console.log('Stats:', manager.getStats());

    await bridge.stop();
    EOF
    node /tmp/test-stdlib-index.mjs
    ```

    Expected: All modules show "loaded (N symbols)" with N > 0.
  </action>
  <verify>Test shows loaded with symbols > 0 for all modules</verify>
  <done>StdlibIndexManager.loadModule() returns StdlibModuleInfo with symbols for bootstrap modules</done>
</task>

</tasks>

<verification>
Run the test command from Task 2. Verify:
- [ ] Stdio loads with symbols > 0
- [ ] String loads with symbols > 0
- [ ] Array loads with symbols > 0
- [ ] Mapping loads with symbols > 0
- [ ] Stats show moduleCount >= 4
- [ ] No modules in negativeCache from bootstrap list
</verification>

<success_criteria>
1. StdlibIndexManager no longer blocks bootstrap modules
2. Common stdlib modules (Stdio, String, Array, Mapping) load successfully
3. Hover on stdlib types will now work (manager returns symbols)
</success_criteria>

<output>
After completion, create `.planning/phases/16-stdlib-performance/16-02-SUMMARY.md`
</output>
